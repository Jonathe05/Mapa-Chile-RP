<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>Mapa Chile RP</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
<style>
  html, body {
    margin: 0; padding: 0; height: 100%;
    background: #111;
    display: flex; justify-content: center; align-items: center;
  }
  #visor {
    width: 800px;
    height: 600px;
    border: 2px solid #444;
    overflow: hidden;
    position: relative;
    background: #000;
    border-radius: 10px;
    box-shadow: 0 0 20px rgba(0,0,0,0.7);
    touch-action: none;
    user-select: none;
  }
  #mapa {
    position: absolute;
    top: 0;
    left: 0;
    transform-origin: top left;
    user-select: none;
    max-width: none;
    max-height: none;
    cursor: grab;
    -webkit-user-drag: none;
  }
  .zoom-controls {
    position: absolute;
    bottom: 15px;
    right: 15px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    z-index: 10;
  }
  .zoom-controls button {
    background: #fff;
    border: none;
    padding: 10px;
    font-size: 20px;
    border-radius: 5px;
    cursor: pointer;
    box-shadow: 0 0 5px rgba(0,0,0,0.5);
    user-select: none;
  }
</style>
</head>
<body>
  <div id="visor">
    <img id="mapa" src="mapa.png" alt="Mapa Chile RP" />
    <div class="zoom-controls">
      <button id="zoom-in">＋</button>
      <button id="zoom-out">－</button>
    </div>
  </div>

<script>
  const visor = document.getElementById('visor');
  const mapa = document.getElementById('mapa');

  let scale = 1;
  let offset = { x: 0, y: 0 };
  let isDragging = false;
  let lastPos = { x: 0, y: 0 };

  // Actualiza la posición y zoom del mapa
  function updateTransform() {
    mapa.style.transform = `translate(${offset.x}px, ${offset.y}px) scale(${scale})`;
  }

  // Limita el movimiento para que no salga del visor
  function limitOffset() {
    const minX = visor.clientWidth - mapa.naturalWidth * scale;
    const minY = visor.clientHeight - mapa.naturalHeight * scale;

    offset.x = Math.min(0, Math.max(minX, offset.x));
    offset.y = Math.min(0, Math.max(minY, offset.y));
  }

  // Inicializar posición centrada
  mapa.addEventListener('load', () => {
    offset.x = (visor.clientWidth - mapa.naturalWidth * scale) / 2;
    offset.y = (visor.clientHeight - mapa.naturalHeight * scale) / 2;
    updateTransform();
  });

  // Drag con mouse
  visor.addEventListener('mousedown', (e) => {
    if (e.button !== 0) return; // solo click izquierdo
    isDragging = true;
    lastPos = { x: e.clientX, y: e.clientY };
    mapa.style.cursor = 'grabbing';
  });

  window.addEventListener('mouseup', () => {
    if (isDragging) {
      isDragging = false;
      mapa.style.cursor = 'grab';
    }
  });

  window.addEventListener('mousemove', (e) => {
    if (!isDragging) return;
    const dx = e.clientX - lastPos.x;
    const dy = e.clientY - lastPos.y;
    offset.x += dx;
    offset.y += dy;
    lastPos = { x: e.clientX, y: e.clientY };
    limitOffset();
    updateTransform();
  });

  // Soporte táctil (móvil)
  visor.addEventListener('touchstart', (e) => {
    if (e.touches.length === 1) {
      isDragging = true;
      lastPos = { x: e.touches[0].clientX, y: e.touches[0].clientY };
    }
  });

  visor.addEventListener('touchmove', (e) => {
    if (!isDragging || e.touches.length !== 1) return;
    const dx = e.touches[0].clientX - lastPos.x;
    const dy = e.touches[0].clientY - lastPos.y;
    offset.x += dx;
    offset.y += dy;
    lastPos = { x: e.touches[0].clientX, y: e.touches[0].clientY };
    limitOffset();
    updateTransform();
  });

  visor.addEventListener('touchend', () => {
    isDragging = false;
  });

  // Zoom centrado en posición del cursor
  function zoomAt(factor, cx, cy) {
    const oldScale = scale;
    scale = Math.min(Math.max(0.2, scale * factor), 3);

    // Ajustar offset para que el zoom se centre en (cx, cy)
    offset.x -= (cx - offset.x) * (scale / oldScale - 1);
    offset.y -= (cy - offset.y) * (scale / oldScale - 1);
    limitOffset();
    updateTransform();
  }

  // Botones zoom
  document.getElementById('zoom-in').addEventListener('click', () => {
    zoomAt(1.1, visor.clientWidth / 2, visor.clientHeight / 2);
  });
  document.getElementById('zoom-out').addEventListener('click', () => {
    zoomAt(0.9, visor.clientWidth / 2, visor.clientHeight / 2);
  });

  // Zoom con rueda de mouse (centrado en cursor)
  visor.addEventListener('wheel', (e) => {
    e.preventDefault();
    const rect = visor.getBoundingClientRect();
    const cx = e.clientX - rect.left;
    const cy = e.clientY - rect.top;
    const factor = e.deltaY < 0 ? 1.1 : 0.9;
    zoomAt(factor, cx, cy);
  });
</script>
</body>
</html>

